---
slug: xxx
title: xxx
meta_title: x
description: xxx
date: 2024-12-22
image: /images/blog/0052-terramaster-nas.jpg
category: hardware
tags: [NAS, Hardware, Terramaster]
draft: false
---

## 0. Motivation

In this guide, I'll walk you through installing and configuring MEGASync on a TerraMaster NAS using Docker. This setup is particularly useful because **TOS CloudSync doesn't support MEGA**, leaving users with limited options for seamless synchronization with MEGA cloud storage. Using Docker, you can overcome this limitation and enjoy a fully functional sync setup.

If you're just starting with your TerraMaster NAS, I recommend checking out my previous post <FancyLink linkText="Setting Up and Optimizing a Terramaster NAS" url="https://villoro.com/blog/setting-up-terramaster-nas/" dark="true"/>, where I cover the basics to get your device up and running. Once your NAS is set up, this guide will help you extend its functionality with MEGASync.

## 1. About TOS Paths

TerraMaster's TOS handles user directories in a specific way that can sometimes cause confusion or issues with Docker containers. While user folders are displayed in TOS under `/home/<username>`, these directories are actually mapped internally to `/Volume1/User/<username>`. This discrepancy can lead to problems with Docker containers, particularly when they require consistent and predictable file paths.

### 1.1. Proposed Directory Structure for MEGASync

Based on conventions used by other apps like **Tailscale**, I recommend the following paths for MEGASync:

* **Configuration Files**: `/home/<admin_username>/MOD_CONFIG/Mega/<username>`. This path organizes MEGASync configurations under a dedicated MOD_CONFIG folder, keeping the structure clean and consistent with other apps.

* **Synced Data**: `/home/<username>`. Using the root directory of the target user ensures straightforward access and avoids conflicts with other applications.

## 2. Run the MEGASync Docker Container

You can set up MEGASync either via the terminal or by using Portainer. Choose the option that works best for you:

> [!warning] **Default Path Issues**
> The default configuration path for MEGASync includes spaces (`/megasync/.local/share/data/Mega Limited/MEGAsync`), which can cause parsing and permission problems. To avoid this, we set the `DATA_DIR` environment variable to `/megasync/config`.

### 2.1. Option 1: Using the Terminal

Run the following command:

```bash
docker run -d \
  --name=megasync-<username> \
  -p 8081:8080 \
  --env 'DATA_DIR=/megasync/config' \
  --env 'CUSTOM_RES_W=1280' \
  --env 'CUSTOM_RES_H=720' \
  --volume "/home/<admin_username>/MOD_CONFIG/Mega/<username>:/megasync/config" \
  --volume "/home/<username>:/sync-data" \
  --restart=always \
  ich777/megasync
```

<Notice type="warning">
  You must replace `<admin_username>` and `<username>`.
</Notice>

### 2.2. Option 2: Using Portainer

Use the following YAML configuration:

```yaml
Name: megasync-villoro
Image: ich777/megasync:latest
Network ports configuration:
  Manual network port publishing:
    host: 8081 # Change it
    container: 8080
Advanced container settings:
  Volumes:
    - container: /megasync/config
      type: bind
      host: /home/<admin_username>/MOD_CONFIG/Mega/villoro
    - container: /sync-data
      type: bind
      host: /home/villoro
  Env:
    - name: CUSTOM_RES_W
      value: 1280
    - name: CUSTOM_RES_H
      value: 720
    - name: DATA_DIR
      value: /megasync/config
Restart Policy: Always
```

After entering the YAML configuration in Portainer, click `Deploy the container`.

> [!tip] **Verify Ports**
> Use the following command to ensure the container is listening on the correct ports:
> ```bash
> netstat -tuln | grep LISTEN
> ```

## 3. Access the MEGASync Web Interface
Once the container is running, access the MEGASync interface:

1. Open your browser and navigate to:
   ```
   http://<NAS_IP>:8081/vnc_auto.html
   ```
   Replace `<NAS_IP>` with your NASâ€™s IP address.

2. Log in to your MEGA account and set up synchronization:
   - **Local Folder**: Choose `/sync-data` or a subdirectory.
   - **MEGA Folder**: Select the folder in your MEGA account to sync with.

> [!important] **Local Folder Setup**
> Always choose `/sync-data` (or a subdirectory) for the **local folder** during synchronization setup to ensure proper syncing with the host.

## 4. Verify the Setup
- Monitor the container logs to ensure there are no errors:
  ```bash
  docker logs megasync
  ```

- Test synchronization by adding files to `/home/villoro` and confirming they appear in your MEGA account (and vice versa).

## 5. Adding Multiple Users

This setup is designed to work for multiple users. To sync another user, simply repeat the steps to run the Docker container. Use another `user_name` with the new username in all relevant paths and container names. For example:

- Configuration Path: `/home/<admin_username>/MOD_CONFIG/Mega/<new_username>`
- Sync Data Path: `/home/<new_username>`
- Container Name: `megasync-<new_username>`
- Port: Use a different host port (e.g., `8082:8080`) to avoid conflicts.

By doing so, each user will have their own isolated MEGAsync instance.

## 6. Troubleshooting

1. **Permission Denied Errors**:
   - Ensure the mapped directories have the correct permissions:
     ```bash
     chmod -R 777 /home/<admin_username>/MOD_CONFIG/Mega/villoro
     chmod -R 777 /home/villoro
     ```

2. **Logs Indicate Missing Commands**:
   - Errors like `xrdb: command not found` are harmless and can be ignored.

3. **Access Issues**:
   - Ensure the container is running:
     ```bash
     docker ps
     ```
   - Verify the port mapping matches your setup.

---

By following this guide, youâ€™ve successfully set up MEGASync on your TerraMaster NAS. This setup enables seamless synchronization between your local NAS storage and MEGA cloud storage. If you encounter issues or have questions, feel free to leave a comment or reach out.

Happy syncing! ðŸ˜Š
