# --------------------------------------------------------------------------------------------------
# Basic metadata
# --------------------------------------------------------------------------------------------------
code: pyarrow
title: Efficently reading from redshift large volumes of data with pyarrow
title_short: Reading from redshift
date: "2021-06-08"
image: default.jpg
highlight: True

tags:
  - Python
  - Redshift
  - Pyarrow
  - SQL

tags_filter:
  - Python
  - Redshift
  - SQL

# --------------------------------------------------------------------------------------------------
# Extra info. This will add a button with href to the url
# --------------------------------------------------------------------------------------------------
link: 
  text: Github
  url: https://github.com/villoro/villoro_posts/tree/master/0037-pyarrow


# --------------------------------------------------------------------------------------------------
# Content
# --------------------------------------------------------------------------------------------------
brief_markdown: |
  xx

use_chartjs: True

content_markdown: |

  ## Table of Contents

  [TOC]

  ## 1. xx

  <canvas id="dataset_0" style="width:100%;height:400px;"></canvas>

  # Partition by

  <canvas id="dataset_2" style="width:100%;height:400px;"></canvas>

  <canvas id="dataset_1" style="width:100%;height:400px;"></canvas>

  # Best functions

  <canvas id="pyarrow_best" style="width:100%;height:400px;"></canvas>

  # Row group

  <canvas id="row_group" style="width:100%;height:400px;"></canvas>

scripts: |
  <script>
    const scale_seconds = {
      scales: {
        yAxes: [{
          scaleLabel: {
            display: true,
            labelString: 'Time [seconds]'
          }
        }]
      }
    }
    const functions = ['pandas_read', 'pyarrow_ds_read', 'pyarrow_parquet_ds_read', 'pyarrow_single_read']
    const datasets = ['dataset_1', 'dataset_2']

    var dataset_0 = new Chart("dataset_0", {
      type: 'bar',
      data: {
        labels: functions,
        datasets: [
          {
            label: 'no_filter',
            backgroundColor: "#EF5350",
            data: [8.856600, 7.468612, 7.463320, 9.433437],
          },
        ],
      },
      options: {
        title: {
          display: true,
          text: 'Reading time for dataset 0 (single parquet)'
        },
        legend: {
          display: false
        },
        ...scale_seconds
      }
    });

    var dataset_2 = new Chart("dataset_2", {
      type: 'bar',
      data: {
        labels: functions,
        datasets: [
          {
            label: 'filter',
            backgroundColor: "#FF9800",
            data: [29.401111, 0.582480, 0.739624, 29.645606],
          },
          {
            label: 'no_filter',
            backgroundColor: "#FFCC80",
            data: [22.709390, 7.273302, 8.621203, 28.806552],
          },
        ],
      },
      options: {
        title: {
          display: true,
          text: 'Reading time for dataset 1 (One parquet by day)'
        },
        ...scale_seconds
      }
    });

    var dataset_1 = new Chart("dataset_1", {
      type: 'bar',
      data: {
        labels: functions,
        datasets: [
          {
            label: 'filter',
            backgroundColor: "#8BC34A",
            data: [7.235872, 0.464466, 0.394429, 7.429504],
          },
          {
            label: 'no_filter',
            backgroundColor: "#C5E1A5",
            data: [5.349147, 4.558274, 4.739228, 5.164837],
          },
        ],
      },
      options: {
        title: {
          display: true,
          text: 'Reading time for dataset 1 (One parquet by day)'
        },
        ...scale_seconds
      }
    });

    var pyarrow_best = new Chart("pyarrow_best", {
      type: 'bar',
      data: {
        labels: datasets,
        datasets: [
          {
            label: 'pyarrow_ds_read',
            backgroundColor: "#4FC3F7",
            data: [0.464466, 0.582480],
          },
          {
            label: 'pyarrow_parquet_ds_read',
            backgroundColor: "#9575CD",
            data: [0.394429, 0.739624],
          },
        ],
      },
      options: {
        title: {
          display: true,
          text: 'Reading time for dataset 1 (One parquet by day)'
        },
        ...scale_seconds
      }
    });

    var row_group = new Chart("row_group", {
      type: 'bar',
      data: {
        labels: datasets,
        datasets: [
          {
            label: 'pyarrow_ds_read',
            backgroundColor: "#29B6F6",
            data: [0.495962, 0.623322],
          },
          {
            label: 'pyarrow_parquet_ds_read',
            backgroundColor: "#7E57C2",
            data: [1.254674, 2.003886],
          },
        ],
      },
      options: {
        title: {
          display: true,
          text: 'Reading time for dataset 1 (One parquet by day)'
        },
        ...scale_seconds
      }
    });
  </script>

