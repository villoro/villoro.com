---
slug: extracting-data-salesforce-python
title: Extracting data from Salesforce with Python
meta_title: Extracting data from Salesforce
description: xx
date: 2024-05-24
image: "/images/blog/0046-salesforce.jpg"
tags: ["Python", "DE"]
draft: false
---

## Table of Contents

[TOC]

## 0. Motivation

## 1. Simple Salesforce

https://github.com/simple-salesforce/simple-salesforce

## 2. Querying options

### 2.1. Get Entity

`sf.Contact.get('003e0000003GuNXAA0')`

### 2.2. query and query_all

https://simple-salesforce.readthedocs.io/en/latest/user_guide/queries.html

`sf.query("SELECT Id, Email, ParentAccount.Name FROM Contact WHERE LastName = 'Jones'")`
`sf.query_all("SELECT Id, Email FROM Contact WHERE LastName = 'Jones'")`

### 2.3. query_all_iter

```python
data = sf.query_all_iter("SELECT Id, Email FROM Contact WHERE LastName = 'Jones'")
for row in data:
  process(row)
```

### 2.4. Bulk

```python
query = 'SELECT Id, Name FROM Account'

# generator on the results page
fetch_results = sf.bulk.Account.query_all(query, lazy_operation=True)

# the generator provides the list of results for every call to next()
all_results = []
for list_results in fetch_results:
  all_results.extend(list_results)
```

### 2.5. Bulk2

```python
query = 'SELECT Id, Name FROM Account LIMIT 100000'

results = sf.bulk2.Account.query(
    query, max_records=50000, column_delimiter="COMM", line_ending="LF"
)
for i, data in enumerate(results):
    with open(f"results/part-{1}.csv", "w") as bos:
        bos.write(data)
```

## 3. Query limits

### 3.1. Batches

### 3.2. Max days per query

## 4. Types of columns

Columns in Salesforce are flexible and they can contain different types of data.
I like to classify columns in three types:

1. **Primitive columns**: those show information about the entity itself.
2. **Reference columns**: those are links to other tables, similar to a join.
3. **Calculated columns**: those are formulas based on other fields. Those fields can be from referenced tables.

### 4.1. Primitive columns

Those are the basic type of columns. They show information about the entity itself.
For example, if we are working with the `User` table, it will have some primitive columns like:

* `firstname`: the name of the user (string)
* `age`: how old the user is (int)

### 4.2. Reference columns

Those columns are references to other tables.
Under the hood they behave similarly to a `join` in SQL.

The 2 important parts of reference columns are:

* `referenceTo`: this shows to which entity the column refers to
* `relationshipName`: the name that entity will have. Think of it as the alias after a join

Here you have a sample of reference columns:

| name             | type      | referenceTo     | relationshipName |
|------------------|-----------|-----------------|------------------|
| CreatedById      | reference | [User]          | CreatedBy        |
| LastModifiedById | reference | [User]          | LastModifiedBy   |
| Delegation__c    | reference | [Delegation__c] | Delegation__r    |
| User__c          | reference | [User]          | User__r          |

### 4.3. Calculated columns

Those columns are populated at query time based on a formula.
For example, in the `User` table we could have `firstName` and `lastName` as primitive columns and then `fullName` defined as `FirstName & ’ ’ & LastName`.

<Notice type="warning">
  Calculated columns can use information from `referenced` entities!
</Notice>

Let's imagine the we have the `Order` table which has those columns (among others):

| name             | type      | referenceTo | relationshipName                                      |
|------------------|-----------|-------------|-------------------------------------------------------|
| CreatedById      | reference | [User]      | CreatedBy                                             |
| LastModifiedById | reference | [User]      | LastModifiedBy                                        |
| User__c          | reference | [User]      | <span style="background-color:yellow;">User__r</span> |

We could have here a **calculated** column called `fullName` with the following formula: `User__r.FirstName & ’ ’ & User__r.LastName`.

In that case, `fullName` will have information based on the table `Users` and not the `Orders`.

<Notice type="error">
  When extracting data those columns are very dangerous since **changes in the referenced table does not modify the `LastModifiedDate` from the main table**.
  In the example above, we would see a different `fullName` if `User.FirstName` is modified but the `Order` table will have the same `LastModifiedDate` as before, since the `Order` table hasn't been modified. This is dangerous for data extractions.
</Notice>

## 5. Query including external changes

| name             | calculated | calculatedFormula | type      | referenceTo     | relationshipName                                                |
|------------------|------------|-------------------|-----------|-----------------|-----------------------------------------------------------------|
| Id               | False      |                   | id        |                 |                                                                 |
| CreatedById      | False      |                   | reference | [User]          | <span style="background-color:PaleGreen;">CreatedBy</span>      |
| LastModifiedById | False      |                   | reference | [User]          | <span style="background-color:PaleGreen;">LastModifiedBy</span> |
| Delegation__c    | False      |                   | reference | [Delegation__c] | <span style="background-color:PaleGreen;">Delegation__r</span>  |
| User__c          | False      |                   | reference | [User]          | <span style="background-color:Salmon;">User__r</span>           |
| UserName__c      | True       | <span style="background-color:Salmon;">User__r</span>.FirstName &amp; ' ' &amp; <span style="background-color:Salmon;">User__r</span>.LastName | string | | |
| IsDeleted        | False      |                   | boolean   |                 |                                                                 |
| Name             | False      |                   | string    |                 |                                                                 |
| CreatedDate      | False      |                   | datetime  |                 |                                                                 |
| LastModifiedDate | False      |                   | datetime  |                 |                                                                 |
| SystemModstamp   | False      |                   | datetime  |                 |                                                                 |
