---
slug: setting-up-nas-terramaster
title: xx
meta_title: xx
description: xx
date: 2024-10-24
image: /images/blog/0053-terramaster-nas.jpg
category: hardware
tags: [NAS, Hardware]
draft: false
---

## 0. Motivation

xx

## 1. Initial Setup

First of all, if you need a detailed installation guide you should read <FancyLink linkText="Terramaster Quickguide" url="https://support.terra-master.com/quickguide/" company="terramaster"/>.
In this post I'll explain the points that were most relevant to me.

### 1.1. Locating the NAS

The first thing you will need to do is to locate the NAS inside your network.
With a Terramaster NAS you can head over to `http://tnas.local` and after a couple of cliks, you will see the NAS IP.
Alternatively you can use an app that analyzes your network (such as <FancyLink linkText="Fing" url="https://www.fing.com/"/>).

### 1.2. Install Terramaster OS (TOS)

<Notice type="info">
  I want to install TOS on the SSD so that when it's idle the HDD can sleep.
</Notice>

You can do it by:

1. Selecting a custom configuration
2. Select all SSDs you have
3. Online install

This will create a partition in each disk you selected with the OS.
While you wait I think it's a good moment to make sure you have a proper network setup.

## 2. Avoiding double NAT

Some of us have a secondary router because we don't like the one the Internet Service Provider (ISP) provides for free.
Those routers are usually not very powerful and can lack advanced features.

In that case, you might have double NAT (see <FancyLink linkText="Double NAT explained and possible solutions" url="https://medium.com/@gmanual/double-nat-explained-and-possible-solutions-8b41b6c651bd" dark="true"/> for more info) which might cause you problems.

You have multiple options to solve it, what I recommend is one of the following:
1. Set the ISP router in bridge mode
2. Create a DMZ

In my case, I could not set up the ISP router in bridge mode, so I went for a DMZ.

<Notice type="warning">
  This will be very different for each setup and router models, but here you have what worked for me.
</Notice>

### 2.1. Reserve an IP for you secondary router

The first step for setting up a DMZ is to assing an IP for your secondary router by:

1. Get the mac address of the secondary router
2. Go to the ISP router config
2. Create a DHCP binding for the secondary router. For simplicity use the IP it's currently using

### 2.2. DMZ

Then create the DMZ itself by:

1. Go to the ISP router config
2. Create a DMZ for the IP of the secondary router

## 3. Handling storage

Once TOS installation finishes you can create your superuser. Afterwards you are ready to set up the storege.

<Notice type="warning">
  You can use `letters`, `numbers` and `special characters` in your passwords. And at least it can be 64 characters long.
</Notice>

### 3.1. Creating a storage pool

The first thing you will need to decide is the `RAID` you want. Here I suggest:
* `TRAID` if you have different disk sizes in order to avoid wasted space
* `TRAID` if you plan on adding more disks later, since you won't need to recreate the volume
* A standard `RAID` (0, 1, 5 or 6) if you have same size disks and you won't add extra disks (so that it's compatible with other OS and it's easier to recover in case of failures.)

Regarding the storage formats you can go with `EX4` or `BTRFS`.
Honestly I'm no expert here, I chose `EX4` because I read it's more stable.
You can read more about it in <FancyLink linkText="BTRFS vs EX4 | Terramaster forum" url="https://forum.terra-master.com/en/viewtopic.php?t=1851#:~:text=Re%3A%20BTRFS%20vs%20EXT4,-Post%20by%20TMzethar&text=The%20ext4%20format%20will%20retain,stable%20in%20terms%20of%20stability" company="terramaster"/>.

<Notice type="info">
  HDDs will be noisy during the storage pool creation (RAID Synchronization), but noise will decrease during regular usage.
</Notice>

### 3.2. Hyper Cache

You can use one of the 2 M2 SSD slots for caching. That can speed up `reads`, `writes` or both (`balanced`). The choice will depend on the NAS usage.

### 3.3. Options for adding data

My model has two 2.5 Gbps ethernet ports which should give file transfers speeds of around 250–280 MB/s.
The alternative is to use the USB 3.1 Gen 1 with an external SSD.
That could offer higher speeds (~300–400 MB/s) but I think it's not worht it since you will first need to copy the data into the SSD and then out of it.

It's important to notice that depending of the RAID you chose, you might reach the HDD speed limit (~250 MB/s for the Seagate Ironwolf Pro I installed).

<Notice type="info">
  In general I suggest you load data into the NAS over ethernet as oposed to using a USB external drive.
</Notice>

## 4. Connecting locally (SSH)

When installing some apps it is very useful to be able to connect a terminaly directly to the NAS (`ssh`).

<Notice type="danger">
  Only do this if you are confortable with `ssh`!
</Notice>

1. Go to `Control Panel`
1. Inside the `Network Services` section select `Terminal & SNMP`
2. Allow SSH access with username and password
3. You should set a custom port for security reasons (defaults to `9222`)

Then with a terminal you can connect to the NAS with:

```sh
ssh [username]@[ip] -p [port]
```

You must replace:
* `[username]`. You must use the first user you created
* `[ip]`
* `[port]`  

<Notice type="warning">
  Once you are done setting up everything I suggest you disable `SSH` to minimize security risks.
</Notice>

## 5. Installing apps

### 5.1. Plex

* Plex Claim Issues: If you're having trouble claiming the Plex server, use the manual token method via https://plex.tv/claim or access the NAS at http://127.0.0.1:32400/web to claim it directly from the local machine.

### 5.2. qBittorrent

Read log for the password, then change it

* qBittorrent App from Terramaster Community:
    * Set up public/Torrents as the monitored folder for new torrents.
    * Configure public/Downloads as the destination for completed downloads in the qBittorrent Web UI.

You must set the paths for where to download the torrents and optionally which folder to watch for adding torrents.

I like using `public/Downloads`. So I'll need to use `/Volume1/public/Downloads` since `Volume1` is the name I gave to the data pool.

### 5.3. Tailscale

```sh
tailsacle set --advertise-exit-node
```

### 5.4. Mega

## UPS

Hardware & Power / enable USB support

