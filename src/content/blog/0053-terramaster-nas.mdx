---
slug: setting-up-terramaster-nas
title: Setting up a Terramster NAS
meta_title: Setting up a Terramster NAS
description: xx
date: 2024-10-24
image: /images/blog/0053-terramaster-nas.jpg
category: hardware
tags: [NAS, Hardware]
draft: false
---

## 0. Motivation

After purchasing the <FancyLink linkText="Terramaster F2-424" url="https://amzn.to/40CRZqJ" company="amazon"/> NAS, I decided to document my setup process. This guide serves as both a personal reference in case I need to reinstall and a practical guide for others who might be setting up a similar NAS configuration.

## 1. About the hardware

For anyone considering a NAS, here’s a summary of my experience and the choices I made for my setup.

### 1.1. The NAS

Previously, I had a Synology D115J, but its CPU wasn’t quite powerful enough for my needs. I wanted a NAS capable of running multiple Docker containers, which required a more robust processor. After researching Synology and QNAP models, I found that their budget options were often limited by outdated CPUs.

That’s when I came across the Terramaster NAS lineup. Although I initially had reservations about Terramaster's Operating System (TOS), reviews suggested that it was straightforward to replace TOS with options like Unraid or TrueNAS if needed. Ultimately, I decided on a 2-bay NAS for simplicity, choosing fewer but larger disks for storage capacity. The <FancyLink linkText="Terramaster F2-424" url="https://amzn.to/40CRZqJ" company="amazon"/> offered the best balance of power and flexibility for my setup.

### 1.2. The Hard Drives

When selecting drives, I prioritized models rated for 24/7 operation, essential for NAS use. Initially, I purchased <FancyLink linkText="Seagate Exos X18 3.5 16TB" url="https://amzn.to/3O2h2vX" company="amazon"/> drives because they were cost-effective. However, the noise level turned out to be too disruptive, especially with the NAS housed in a cabinet near my living room. Fortunately, I was able to exchange them for <FancyLink linkText="Seagate IronWolf Pro 3.5 NAS 16TB" url="https://amzn.to/4eopD6G" company="amazon"/> drives (at an additional 90€ per drive). Although pricier, the IronWolf Pro drives are significantly quieter and better suited to my setup.

### 1.3. The UPS

To protect the NAS from potential power outages, I opted for a UPS with a USB connection, enabling automatic shutdown of the NAS during an outage. I chose the <FancyLink linkText="Master Power (UPS 650 VA - 360W)" url="https://amzn.to/3YDj7Dw" company="amazon"/> as a budget-friendly option, which is ideal for low-power devices like my NAS. This UPS provides just enough backup power to safely handle brief outages and help prevent data loss.

## 2. Initial Setup

First of all, if you need a detailed installation guide you should read <FancyLink linkText="Terramaster Quickguide" url="https://support.terra-master.com/quickguide/" company="terramaster"/>.
In this post I'll explain the points that were most relevant to me.

### 2.1. Locating the NAS

The first thing you will need to do is to locate the NAS inside your network.
With a Terramaster NAS you can head over to <FancyLink linkText="tnas.local" url="http://tnas.local" dark="true" company="default"/> and after a couple of cliks, you will see the NAS IP.
Alternatively you can use an app that analyzes your network (such as <FancyLink linkText="Fing" url="https://www.fing.com/"/>).

### 2.2. Install Terramaster OS (TOS)

<Notice type="info">
  I want to install TOS on the SSD so that when it's idle the HDD can sleep.
</Notice>

You can do it by:

1. Selecting a custom configuration
2. Select all SSDs you have
3. Online install

This will create a partition in each disk you selected with the OS.
While you wait I think it's a good moment to make sure you have a proper network setup.

## 3. Network Configuration

Some of us have a secondary router because we don't like the one the Internet Service Provider (ISP) provides for free.
Those routers are usually not very powerful and can lack advanced features.

In that case, you might have double NAT (see <FancyLink linkText="Double NAT explained and possible solutions" url="https://medium.com/@gmanual/double-nat-explained-and-possible-solutions-8b41b6c651bd" dark="true"/> for more info) which might cause you problems.

You have multiple options to solve it, what I recommend is one of the following:
1. Set the ISP router in bridge mode
2. Create a DMZ

In my case, I could not set up the ISP router in bridge mode, so I went for a DMZ.

<Notice type="warning">
  This will be very different for each setup and router models, but here you have what worked for me.
</Notice>

### 3.1. Reserve an IP for you secondary router

The first step for setting up a DMZ is to assing an IP for your secondary router by:

1. Get the mac address of the secondary router
2. Go to the ISP router config
2. Create a DHCP binding for the secondary router. For simplicity use the IP it's currently using

### 3.2. DMZ

Then create the DMZ itself by:

1. Go to the ISP router config
2. Create a DMZ for the IP of the secondary router

## 4. Handling storage

Once TOS installation finishes you can create your superuser. Afterwards you are ready to set up the storege.

<Notice type="warning">
  You can use `letters`, `numbers` and `special characters` in your passwords. And at least it can be 64 characters long.
</Notice>

### 4.1. Creating a storage pool

The first thing you will need to decide is the `RAID` you want. Here I suggest:
* `TRAID` if you have different disk sizes in order to avoid wasted space
* `TRAID` if you plan on adding more disks later, since you won't need to recreate the volume
* A standard `RAID` (0, 1, 5 or 6) if you have same size disks and you won't add extra disks (so that it's compatible with other OS and it's easier to recover in case of failures.)

Regarding the storage formats you can go with `EX4` or `BTRFS`.
Honestly I'm no expert here, I chose `EX4` because I read it's more stable.
You can read more about it in <FancyLink linkText="BTRFS vs EX4 | Terramaster forum" url="https://forum.terra-master.com/en/viewtopic.php?t=1851#:~:text=Re%3A%20BTRFS%20vs%20EXT4,-Post%20by%20TMzethar&text=The%20ext4%20format%20will%20retain,stable%20in%20terms%20of%20stability" company="terramaster"/>.

<Notice type="info">
  HDDs will be noisy during the storage pool creation (RAID Synchronization), but noise will decrease during regular usage.
</Notice>

### 4.2. Hyper Cache

You can use one of the 2 M2 SSD slots for caching. That can speed up `reads`, `writes` or both (`balanced`). The choice will depend on the NAS usage.

### 4.3. Options for adding data

My model has two 2.5 Gbps ethernet ports which should give file transfers speeds of around 250–280 MB/s.
The alternative is to use the USB 3.1 Gen 1 with an external SSD.
That could offer higher speeds (~300–400 MB/s) but I think it's not worht it since you will first need to copy the data into the SSD and then out of it.

It's important to notice that depending of the RAID you chose, you might reach the HDD speed limit (~250 MB/s for the Seagate Ironwolf Pro I installed).

<Notice type="info">
  In general I suggest you load data into the NAS over ethernet as oposed to using a USB external drive.
</Notice>

## 5. Connecting locally (SSH)

When installing some apps it is very useful to be able to connect a terminaly directly to the NAS (`ssh`).

<Notice type="danger">
  Only do this if you are confortable with `ssh`!
</Notice>

1. Go to `Control Panel`
1. Inside the `Network Services` section select `Terminal & SNMP`
2. Allow SSH access with username and password
3. You should set a custom port for security reasons (defaults to `9222`)

Then with a terminal you can connect to the NAS with:

```sh
ssh [username]@[ip] -p [port]
```

You must replace:
* `[username]`. You must use the first user you created
* `[ip]`
* `[port]`  

<Notice type="warning">
  Once you are done setting up everything I suggest you disable `SSH` to minimize security risks.
</Notice>

## 6. Installing apps

In the `App Center` you can install apps either from the `Terramaster` or from the `Community`.

In my case I'll use:
* Plex
* qBittorrent
* Docker (`Docker Engine`, `Docker Manager` and `Portainer`)
* Tailscale (community app)

### 6.1. Plex

The configuration is quite straightforward. You will need to open the app and sign in into plex.
Afterwards you can create your libraries as usual.
I suggest putting the plex libraries inside the `Public` folder so that 

### 6.2. qBittorrent

When you install qBittorrent an `admin` user will be created with a password (`adminadmin`)

<Notice type="info">
  If you used the community app the password will be randomnly created. You can get it from the logs.
</Notice>

<Notice type="warning">
  The first thing you need to do is change the default password.
  You can do it at `Tools/Options/Web UI/Authentication`
</Notice>

Regarding downloads I prefer having them inside `public` (`/Volume1/public/Downloads`) folder so that every user can access them.

Finally I like adding a folder that is whatched for new torrents and to move the added ones and completed ones into subfolders.
You can set it up in `Tools/Options/Downloads` with:

* Monitored folder: `/Volume1/public/Torrents/`
* Copy `.torrent` files to: `/Volume1/public/Torrents/Added/`
* Copy `.torrent` files for finished downloads to: `/Volume1/public/Torrents/Downloaded/`

### 6.3. Tailscale

This is a community app. You can download it from <FancyLink linkText="Tailscale | TerraMaster Community Place" url="https://tmnascommunity.eu/download/tailscale/" dark="true" company="default"/>. To install it you need to upload the file to `App Center/Settings/Install application manually`.

In order to connect the NAS to your tailscale you will need to register.
First download the logs (`/<your_user>/MOD_CONFIG/Tailscale/Tailscale_start.log`).
There you will find the `login url` which should look like:

```plaintext
To authenticate, visit:

  https://login.tailscale.com/a/xxxxxxxxxxxxxx
```

Once you have added it, it should appear in your admin console. Optinally you can change it's name to something like `nas`.

#### 6.3.1. Set the NAS as an exit node

Optionally you can set the NAS as an exit node.
You will need to SSH into the NAS.
If you do it with a computer where you have tailscale install and connect you can reference the machine name (`nas`) instead of the IP.

So you can SSH as we saw before
```sh
ssh [username]@nas -p [port]
```
Remember to replace `[username]` (you must use the first user you created) and `[port]`.

Then you can set the NAS as an exit node with:

```sh
tailscale set --advertise-exit-node
```

Finally you might also want to update it and enable auto updates to avoid security problems with:

```sh
tailscale update
tailscale set --auto-update
```

## 7. UPS

In order to protect the NAS from power outages I think it is really important to connect it to a UPS.
Some models can be connected by USB so that whenever there is a power outage the NAS is notified and can be automatically turned off.

To set this up, go to `Control Panel/Hardware & Power` and click `enable USB support`.
